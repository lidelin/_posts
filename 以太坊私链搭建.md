---
title: ä»¥å¤ªåŠç§é“¾æ­å»º
date: 2018-08-06 00:31:44
tags:
    - ethereum
    - blockchain
---

ä»¥å¤ªåŠé’±åŒ…ç›®å‰ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œgeth å’Œ parityã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ geth ä¸ºä¾‹å­ã€‚

# å®‰è£… Geth
## Mac
```bash
brew tap ethereum/ethereum
brew install ethereum
```

## Ubuntu
```bash
sudo apt-get install software-properties-common
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt-get update
sudo apt-get install ethereumsudo apt-get instal
```

# åˆ›å»ºåˆ›ä¸–å—
## å®šä¹‰åˆ›ä¸–å—é…ç½®
åˆ›å»ºä¸€ä¸ªåä¸º genesis.json çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š
```json
{
  "config": {
        "chainId": 22,
        "homesteadBlock": 0,
        "eip155Block": 0,
        "eip158Block": 0
    },
  "alloc"      : {},
  "coinbase"   : "0x0000000000000000000000000000000000000000",
  "difficulty" : "0x4",
  "extraData"  : "",
  "gasLimit"   : "0x2fefd8",
  "nonce"      : "0x0000000000000042",
  "mixhash"    : "0x0000000000000000000000000000000000000000000000000000000000000000",
  "parentHash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
  "timestamp"  : "0x00"
}
```

ä»¥ä¸Šé…ç½®æ–‡ä»¶ä¸­ï¼Œ
- chainId
    æ ‡è¯†å½“å‰ç½‘ç»œï¼Œraw transaction çš„å‚æ•°ä¹‹ä¸€ã€‚
    å…¬é“¾ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š
```
"1": Ethereum Mainnet
"2": Morden Testnet (deprecated)
"3": Ropsten Testnet
"4": Rinkeby Testnet
"42": Kovan Testnet
```
    å› ä¸ºæˆ‘ä»¬æ˜¯ç§é“¾ï¼Œæ‰€ä»¥å®šä¹‰äº†ä¸€ä¸ªè·Ÿä¸Šé¢ 5 ä¸ªé…ç½®ä¸ä¸€æ ·çš„æ•°å­—
    
- alloc
    é¢„å…ˆç»™æŸäº›è´¦å·å……å€¼ eth
    é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š
    ```json
"alloc": {
  "0x0000000000000000000000000000000000000001": {"balance": "111111111"},
  "0x0000000000000000000000000000000000000002": {"balance": "222222222"}
}
    ```
    
- coinbase
    æŒ–çŸ¿æ”¶ç›Šè´¦å·
    
- difficulty
    æŒ–çŸ¿éš¾åº¦
    
## åˆå§‹åŒ–åˆ›ä¸–å—
åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
geth init genesis.json --datadir "/Users/lidelin/work/blockchain/ethereum/node1"
```
--datadir å‚æ•°ç”¨æ¥æŒ‡å®šå­˜æ”¾æ•°æ®çš„ç›®å½•ã€‚

# æŒ–çŸ¿
## å¯åŠ¨
åˆ›å»ºäº†åˆ›ä¸–å—åï¼Œå¯ä»¥è¾“ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨
```bash
geth --networkid 123 --datadir "/Users/lidelin/work/blockchain/ethereum/node1" console
```

console è¡¨ç¤ºå¯åŠ¨å‘½ä»¤è¡Œã€‚

## åˆ›å»ºä»¥å¤ªåŠè´¦å·
```bash
personal.newAccount("123456")
```

## è®¾ç½®æŒ–çŸ¿æ”¶ç›Šè´¦å·
```bash
miner.setEtherbase("0x6b26ff6fa4a85e612158438fe1ed2c613aa6dfe0")
```

## æŸ¥è¯¢è´¦å·ä½™é¢
```bash
web3.fromWei(eth.getBalance("0x6b26ff6fa4a85e612158438fe1ed2c613aa6dfe0"),"ether")
```
å¯ä»¥çœ‹åˆ°å½“å‰ 0x6b26ff6fa4a85e612158438fe1ed2c613aa6dfe0 çš„ä½™é¢ä¸º 0ã€‚

## å¼€å§‹æŒ–çŸ¿
```bash
miner.start()
```

å½“å‡ºç°
```
INFO [08-06|01:56:51] Successfully sealed new block            number=6 hash=f05319â€¦22410d
INFO [08-06|01:56:51] ğŸ”— block reached canonical chain          number=1 hash=ec8c28â€¦b42fe3
INFO [08-06|01:56:51] ğŸ”¨ mined potential block                  number=6 hash=f05319â€¦22410d
INFO [08-06|01:56:51] Commit new mining work                   number=7 txs=0 uncles=0 elapsed=257.575Âµs
INFO [08-06|01:56:51] Successfully sealed new block            number=7 hash=59ce4dâ€¦b8b6e2
INFO [08-06|01:56:51] ğŸ”— block reached canonical chain          number=2 hash=b11c41â€¦45a91e
INFO [08-06|01:56:51] ğŸ”¨ mined potential block                  number=7 hash=59ce4dâ€¦b8b6e2
INFO [08-06|01:56:51] Commit new mining work                   number=8 txs=0 uncles=0 elapsed=1.432ms
INFO [08-06|01:56:52] Successfully sealed new block            number=8 hash=5a7c7fâ€¦6e1dab
INFO [08-06|01:56:52] ğŸ”— block reached canonical chain          number=3 hash=6b4b4fâ€¦0f53d9
INFO [08-06|01:56:52] ğŸ”¨ mined potential block                  number=8 hash=5a7c7fâ€¦6e1dab
INFO [08-06|01:56:52] Commit new mining work                   number=9 txs=0 uncles=0 elapsed=275.508Âµs
```

è¡¨ç¤ºå¼€å§‹æŒ–çŸ¿ã€‚
æ­¤æ—¶å†æŸ¥è´¦å·ä½™é¢ï¼Œå¯ä»¥å‘ç°å€¼ä¸ä¸º 0 äº†ã€‚

# èŠ‚ç‚¹åŒæ­¥
æ•°æ®ç›®å½•è·¯å¾„ï¼š
èŠ‚ç‚¹ 1 ï¼š/Users/lidelin/work/blockchain/ethereum/node1
èŠ‚ç‚¹ 2 ï¼š/Users/lidelin/work/blockchain/ethereum/node2

æˆ‘ä»¬æŠŠæ­£åœ¨æŒ–çŸ¿çš„ç»ˆç«¯å«ç»ˆç«¯ Aï¼Œ
æ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œå«ç»ˆç«¯ Bï¼Œè¾“ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
geth init genesis.json --datadir "/Users/lidelin/work/blockchain/ethereum/node2"
geth --networkid 123 --datadir "/Users/lidelin/work/blockchain/ethereum/node2" --port 30304 console
```
- åˆ›å»ºåˆ›ä¸–åŒºå—ç”¨çš„ genesis.json å’Œåˆšæ‰çš„ä¸€æ ·
- åŠ  --port 30304 æ˜¯ 30303 å·²ç»è¢«ç»ˆç«¯ A æŒ–çŸ¿çš„é‚£ä¸ªèŠ‚ç‚¹ç”¨äº†

åœ¨ç»ˆç«¯ A è¾“ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
```bash
admin.nodeInfo.enode
```

èŠ‚ç‚¹ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤º
```
"enode://ce966c1a9db2a15ff6f6eebc0e53790ed0ec8edbbb45a50c59fd2f6f9da68665259f98a932732301513c25389c64621ac3aae582fba6f4c6b0821d7aa9867a63@10.1.1.67:30303"
```

åœ¨ç»ˆç«¯ B è¾“ä»¥ä¸‹å‘½ä»¤æ·»åŠ åŒæ­¥èŠ‚ç‚¹ï¼š
```bash
admin.addPeer("enode://ce966c1a9db2a15ff6f6eebc0e53790ed0ec8edbbb45a50c59fd2f6f9da68665259f98a932732301513c25389c64621ac3aae582fba6f4c6b0821d7aa9867a63@10.1.1.67:30303")
```

å½“å‡ºç°ä»¥ä¸‹ log æ—¶è¡¨ç¤ºå¼€å§‹åŒæ­¥èŠ‚ç‚¹æ•°æ®
```
INFO [08-06|02:15:33] Imported new chain segment               blocks=1  txs=0 mgas=0.000 elapsed=9.969ms   mgasps=0.000 number=57 hash=96fcadâ€¦29db76
INFO [08-06|02:15:39] Imported new chain segment               blocks=1  txs=0 mgas=0.000 elapsed=10.226ms  mgasps=0.000 number=58 hash=5fcabaâ€¦77a450
INFO [08-06|02:15:40] Imported new chain segment               blocks=1  txs=0 mgas=0.000 elapsed=8.901ms   mgasps=0.000 number=59 hash=adc477â€¦36bfa8
```

